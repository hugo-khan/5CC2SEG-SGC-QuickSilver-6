{% load recipe_helpers %}

{% if recipes %}
  <div class="table-responsive">
    <table class="table table-hover mb-0 recipe-table">
      <thead>
        <tr>
          <th scope="col" style="width: 80%">Recipe Title</th>
          <th scope="col" style="width: 20%; text-align: center;">Favourite</th>
        </tr>
      </thead>
      <tbody>
        {% for recipe in recipes %}
        <tr>
          <td>
            <a href="{% url 'recipe_detail' recipe.pk %}" class="text-decoration-none text-reset d-block">
              <div class="d-flex align-items-center">
                {% if recipe.image %}
                  <div class="me-3" style="width: 64px; height: 48px; overflow: hidden; border-radius: 6px;">
                    <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" style="width:100%; height:100%; object-fit: cover;">
                  </div>
                {% elif recipe.image_url %}
                  <div class="me-3" style="width: 64px; height: 48px; overflow: hidden; border-radius: 6px;">
                    <img src="{{ recipe.image_url }}" alt="{{ recipe.title }}" style="width:100%; height:100%; object-fit: cover;">
                  </div>
                {% endif %}
                <div class="flex-grow-1">
                  <h6 class="mb-0">{{ recipe.title }}</h6>
                  <small class="text-muted">
                    By {{ recipe.created_by.username }} • 
                    {{ recipe.cooking_time|format_cooking_time }} • 
                    <span class="badge difficulty-badge {{ recipe.difficulty|get_difficulty_class }}">
                      {{ recipe.difficulty|title }}
                    </span>
                  </small>
                </div>
              </div>
            </a>
          </td>
          <td class="text-center">
            <form method="post" action="{% url 'toggle_save_recipe' recipe.pk %}" class="d-inline">
              {% csrf_token %}
              {% with is_saved=recipe.id|is_recipe_saved:saved_recipe_ids %}
              <button type="submit" class="btn btn-link p-0" 
                      title="{% if is_saved %}Remove from favourites{% else %}Add to favourites{% endif %}">
                <i class="bi {% if is_saved %}bi-star-fill{% else %}bi-star{% endif %}" style="color: #ffc107; font-size: 1.25rem;"></i>
              </button>
              {% endwith %}
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="empty-state">
    <i class="bi bi-journal-plus empty-state-icon"></i>
    <h4 class="text-muted mt-3">No Recipes Available</h4>
    <p class="text-muted">Check back later for new recipes.</p>
  </div>
{% endif %}